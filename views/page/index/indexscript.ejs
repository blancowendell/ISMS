<script>
    $(document).ready(function () {
        console.log("hello");
        updateTime();
        loadNewApplicants();
        LoadTotal();
        LoadPending();
        LoadVerified();
        LoadChart();


        function LoadChart() {
            $.ajax({
                url: '/loadperbarranggay',
                type: 'GET',
                success: function (response) {
                    // Assuming the data is returned in the format: [{ ms_baranggay: 'XYZ', ms_count: 5 }, ...]
                    let labels = [];
                    let data = [];

                    // Extract data from the response
                    response.data.forEach(item => {
                        labels.push(item.baranggay);  // Barangay names
                        data.push(item.count);        // Counts of verified students
                    });

                    // Create the bar chart
                    let ctx = document.getElementById('barChart').getContext('2d');
                    let barChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Verified Students per Barangay',
                                data: data,
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                borderColor: 'rgba(75, 192, 192, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                },
                error: function (err) {
                    console.error('Error loading data:', err);
                }
            });
        };

        function updateTime() {
            const now = new Date();

            let hours = now.getHours();
            let minutes = now.getMinutes();
            let seconds = now.getSeconds();
            const ampm = hours >= 12 ? 'PM' : 'AM';

            hours = hours % 12;
            hours = hours ? hours : 12;
            minutes = minutes < 10 ? '0' + minutes : minutes;
            seconds = seconds < 10 ? '0' + seconds : seconds;

            const strTime = `${hours}:${minutes}:${seconds} ${ampm}`;

            const day = now.getDate();
            const month = now.toLocaleString('default', { month: 'short' });
            const year = now.getFullYear();
            const strDate = `${day} ${month} ${year}`;

            document.getElementById('dynamic-time').innerHTML = `${strTime} / ${strDate}`;
        }

        setInterval(updateTime, 1000);


        function LoadTotal() {
            console.log("Fetching new applicants...");
            $.ajax({
                url: '/loadtotal',
                method: 'GET',
                success: function (response) {
                    if (response && response.data && response.data.length > 0) {
                        // Assuming response.data[0].msr_VerifiedStudentsCount contains the count
                        let totalStudentsCount = response.data[0].TotalStudentsCount;

                        // Update the corresponding div with the retrieved count
                        $('.verified-students-count').text(totalStudentsCount.toLocaleString());
                    } else {
                        console.error('No data found');
                    }
                },
                error: function (error) {
                    console.error('Error fetching data:', error);
                }
            });
        }

        function LoadPending() {
            console.log("Fetching new applicants...");
            $.ajax({
                url: '/loadpending',
                method: 'GET',
                success: function (response) {
                    if (response && response.data && response.data.length > 0) {
                        // Assuming response.data[0].msr_PendinApplication contains the count
                        let pendingApplicationsCount = response.data[0].PendinApplication;

                        // Update the corresponding div with the retrieved count
                        $('.pending-applications-count').text(pendingApplicationsCount.toLocaleString());
                    } else {
                        console.error('No data found');
                    }
                },
                error: function (error) {
                    console.error('Error fetching data:', error);
                }
            });
        }

        function LoadVerified() {
            1
            $.ajax({
                url: '/loadverified',
                method: 'GET',
                success: function (response) {
                    if (response && response.data && response.data.length > 0) {
                        // Assuming response.data[0].msr_VerifiedStudentsCount contains the count
                        let verifiedStudentsCount = response.data[0].VerifiedStudentsCount;

                        // Update the corresponding div with the retrieved count
                        $('.approved-students-count').text(verifiedStudentsCount.toLocaleString());
                    } else {
                        console.error('No data found');
                    }
                },
                error: function (error) {
                    console.error('Error fetching data:', error);
                }
            });
        }

        function loadNewApplicants() {
            console.log("Fetching new applicants...");

            $.ajax({
                url: "/loadnewapplicants",
                type: "GET",
                success: function (response) {
                    console.log("Data fetched:", response);

                    if (response.data && response.data.length > 0) {
                        let applicantsHtml = '';
                        response.data.forEach((applicant, index) => {
                            applicantsHtml += `
                        <div class="applicant" id="applicant-${index}">
                            <div class="row">
                                <div class="col-md-2">
                                    <img src="data:image/jpeg;base64,${applicant.image}" alt="Applicant Image" class="img-fluid rounded-circle">
                                </div>
                                <div class="col-md-10">
                                    <h5>${applicant.fullname}</h5>
                                    <p>School: ${applicant.schoolname}</p>
                                    <p>Course: ${applicant.corse_code}</p>
                                </div>
                            </div>
                            <hr>
                        </div>`;
                        });
                        $('#applicants').html(applicantsHtml);
                    } else {
                        $('#applicants').html('<p>No new applicants found.</p>');
                    }
                },
                error: function (err) {
                    console.error("Error fetching applicants:", err);
                    $('#applicants').html('<p>Failed to load applicants.</p>');
                }
            });
        }



    });
</script>