<script>
    $(document).ready(function () {
      // Extract token from URL (commented for now)
      // const token = getQueryParam('token');
  
      $(document).on("click", "#resetPasswordForm", function () {
        const newPassword = $("#newPassword").val();
        const token = $("#token").val();
        let message = "";
  
        if (token === "") {
          message += "Token is required ";
        }
  
        if (newPassword === "") {
          message += "New Password is required ";
        }
  
        if (message !== "") {
          showSweetAlert("Required", `Please fill up ${message}`);
        } else {
          // Show waiting alert before sending the AJAX request
          swal({
            title: "Please wait...",
            text: "We are resetting your password.",
            icon: "info",
            buttons: false,
            closeOnClickOutside: false,
          });
  
          // Make the AJAX request
          $.ajax({
            type: "POST",
            url: "/forgotpassword/resetpassword",
            contentType: "application/json",
            data: JSON.stringify({ token, newPassword }),
            success: function (result) {
              if (result.msg === "success") {
                swal({
                  title: "Success!",
                  text: "Password reset successfully.",
                  icon: "success",
                }).then(() => {
                  if (result.data && result.data[0]) {
                    location.replace("/studentindex");
                  } else {
                    location.replace("/login");
                  }
                });
              } else if (result.msg === "graduated") {
                swal({
                  title: "Graduated",
                  text: "Your account is inactive. Please be guided accordingly.",
                  icon: "error",
                  button: "Ok",
                });
              } else if (result.msg === "incorrect") {
                swal({
                  title: "Incorrect",
                  text: "Incorrect credentials. Please try again!",
                  icon: "error",
                  button: "AWW NO!!",
                });
              }
            },
            error: function () {
              swal({
                title: "Error",
                text: "An error occurred while resetting the password.",
                icon: "error",
              });
            },
          });
        }
      });
    });
  </script>
  